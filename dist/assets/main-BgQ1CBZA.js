import{a as e}from"./supabase-C3bvWl8h.js";import{B as t,a as n,R as a,L as s,T as r,C as i,Y as o,X as d,b as c,c as l}from"./charts-DA1IK1Bj.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const u=e("https://rixnizceeggdhlridwrj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpeG5pemNlZWdnZGhscmlkd3JqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwNDY5MzQsImV4cCI6MjA3MzYyMjkzNH0.3YPTcW2_cfS0NCLimGpU2xpp8T5C8LPv-bluQtDB3vQ");class m{static async signUp(e,t){const{data:n,error:a}=await u.auth.signUp({email:e,password:t,options:{emailRedirectTo:window.location.origin}});return{data:n,error:a}}static async signIn(e,t){const{data:n,error:a}=await u.auth.signInWithPassword({email:e,password:t});return{data:n,error:a}}static async signOut(){const{error:e}=await u.auth.signOut();return{error:e}}static async getCurrentUser(){const{data:{user:e},error:t}=await u.auth.getUser();return{user:e,error:t}}static onAuthStateChange(e){return u.auth.onAuthStateChange(e)}}class y{static async createFlashcardSet(e,t,n,a=!1){const{data:{user:s}}=await u.auth.getUser();if(!s)throw new Error("Utente non autenticato");const{data:r,error:i}=await u.from("flashcard_sets").insert({user_id:s.id,name:e,description:t,subject:n,is_public:a}).select().single();return{data:r,error:i}}static async addFlashcards(e,t){const{data:{user:n}}=await u.auth.getUser();if(!n)throw new Error("Utente non autenticato");const a=t.map(((t,n)=>({set_id:e,question:t.domanda,answer:t.risposta,difficulty:t.difficulty||2,order_index:n}))),{data:s,error:r}=await u.from("flashcards").insert(a).select();return r||await u.from("flashcard_sets").update({total_cards:t.length}).eq("id",e),{data:s,error:r}}static async getUserFlashcardSets(){const{data:{user:e}}=await u.auth.getUser();if(!e)throw new Error("Utente non autenticato");const{data:t,error:n}=await u.from("flashcard_sets").select("\n        *,\n        flashcards (*)\n      ").eq("user_id",e.id).order("created_at",{ascending:!1});return{data:t,error:n}}static async getFlashcardSet(e){const{data:t,error:n}=await u.from("flashcard_sets").select("\n        *,\n        flashcards (*)\n      ").eq("id",e).single();return{data:t,error:n}}static async deleteFlashcardSet(e){const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("Utente non autenticato");const{error:n}=await u.from("flashcard_sets").delete().eq("id",e).eq("user_id",t.id);return{error:n}}static async getPublicFlashcardSets(){const{data:e,error:t}=await u.from("flashcard_sets").select("\n        *,\n        flashcards (*)\n      ").eq("is_public",!0).order("created_at",{ascending:!1});return{data:e,error:t}}}class h{static async calculateNext(e,t=0,n=2.5,a=1,s={}){if(s&&0!==Object.keys(s).length||(s=await this.getUserPerformanceStats()||{}),e<3){const e=this.calculatePenalty(s);return{repetitions:0,interval:1,easeFactor:Math.max(1.3,n-.2-e),nextReview:new Date(Date.now()+864e5)}}this.getQualityFactor(e);let r,i=n+(.1-(5-e)*(.08+.02*(5-e)));if(i=Math.max(1.3,Math.min(3,i)),s.consistency>.8&&(i=Math.min(3,i+.1)),0===t)r=1;else if(1===t)r=6;else{const e=this.getPersonalizationFactor(s);r=Math.round(a*i*e)}return{repetitions:t+1,interval:r,easeFactor:i,nextReview:new Date(Date.now()+24*r*60*60*1e3),difficulty:this.calculateDifficulty(e,i,s)}}static calculatePenalty(e){return e.recentErrors>3?.3:e.recentErrors>1?.1:0}static getPersonalizationFactor(e){const t=e.accuracy||.8;return t>.9?1.2:t>.8?1.1:t<.6?.8:1}static getQualityFactor(e){return{5:.15,4:.1,3:.05,2:-.1,1:-.2}[e]||0}static calculateDifficulty(e,t,n){let a=2;return e>=4?a=Math.max(1,a-.5):e<=2&&(a=Math.min(5,a+.5)),t>2.5&&(a=Math.max(1,a-.3)),t<1.8&&(a=Math.min(5,a+.3)),Math.round(10*a)/10}static async getUserPerformanceStats(){try{const{data:{user:e}}=await u.auth.getUser();if(!e)return null;const{data:t,error:n}=await u.from("study_analytics").select("*").eq("user_id",e.id).gte("date",new Date(Date.now()-2592e6).toISOString().split("T")[0]).order("date",{ascending:!1});if(n)throw n;const a=t.reduce(((e,t)=>e+t.cards_studied),0),s=t.reduce(((e,t)=>e+t.correct_answers),0);t.reduce(((e,t)=>e+t.incorrect_answers),0);return{totalCards:a,accuracy:a>0?s/a:0,studyDays:t.length,avgCardsPerDay:t.length>0?a/t.length:0,consistency:this.calculateConsistency(t),recentErrors:this.calculateRecentErrors(t)}}catch(e){return console.error("Errore nel calcolo statistiche performance:",e),null}}static calculateConsistency(e){if(e.length<3)return 0;return e.filter((e=>e.cards_studied>0)).length/e.length}static calculateRecentErrors(e){return e.slice(0,3).reduce(((e,t)=>e+t.incorrect_answers),0)}static async recordStudySession(e,t,n={}){const{data:{user:a}}=await u.auth.getUser();if(!a)throw new Error("Utente non autenticato");const{data:s}=await u.from("study_sessions").select("*").eq("user_id",a.id).eq("card_id",e).single(),r=await this.getUserPerformanceStats();let i;i=s?await this.calculateNext(t,s.repetitions,s.ease_factor,s.interval_days,r):await this.calculateNext(t,0,2.5,1,r);const o={user_id:a.id,card_id:e,quality:t,ease_factor:i.easeFactor,interval_days:i.interval,next_review_date:i.nextReview.toISOString().split("T")[0],repetitions:i.repetitions,studied_at:(new Date).toISOString(),response_time:n.responseTime||null,study_mode:n.mode||"spaced_repetition",device_type:n.deviceType||"desktop"},{data:d,error:c}=await u.from("study_sessions").upsert(o,{onConflict:"user_id,card_id",ignoreDuplicates:!1}).select();return c||await this.updateUserAnalytics(a.id,t,n),{data:d,error:c}}static async updateUserAnalytics(e,t,n){try{const a=(new Date).toISOString().split("T")[0],{data:s,error:r}=await u.from("study_analytics").select("*").eq("user_id",e).eq("date",a).single();if(r&&"PGRST116"!==r.code)throw r;const i={user_id:e,date:a,cards_studied:((null==s?void 0:s.cards_studied)||0)+1,correct_answers:((null==s?void 0:s.correct_answers)||0)+(t>=3?1:0),incorrect_answers:((null==s?void 0:s.incorrect_answers)||0)+(t<3?1:0),study_time_minutes:((null==s?void 0:s.study_time_minutes)||0)+(n.duration||0),updated_at:(new Date).toISOString()};if(s){const{error:e}=await u.from("study_analytics").update(i).eq("id",s.id);if(e)throw e}else{const{error:e}=await u.from("study_analytics").insert(i);if(e)throw e}}catch(a){console.error("Errore nell'aggiornamento analytics:",a)}}static async getCardsForReview(){const{data:{user:e}}=await u.auth.getUser();if(!e)throw new Error("Utente non autenticato");const t=(new Date).toISOString().split("T")[0],{data:n,error:a}=await u.from("study_sessions").select("\n        *,\n        flashcards (\n          *,\n          flashcard_sets (*)\n        )\n      ").eq("user_id",e.id).lte("next_review_date",t).order("next_review_date",{ascending:!0});return{data:n,error:a}}}class g{static async getUserAnalytics(e=30){const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("Utente non autenticato");const{data:n,error:a}=await u.rpc("get_user_analytics",{user_uuid:t.id,days_back:e});return{data:n,error:a}}static async recordStudySession(e){const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("Utente non autenticato");const{data:n,error:a}=await u.from("study_sessions_detailed").insert({user_id:t.id,...e}).select();return{data:n,error:a}}static async updateDailyAnalytics(e,t,n){const{data:{user:a}}=await u.auth.getUser();if(!a)throw new Error("Utente non autenticato");const s=(new Date).toISOString().split("T")[0],{data:r,error:i}=await u.from("study_analytics").upsert({user_id:a.id,date:s,cards_studied:e,correct_answers:t,incorrect_answers:e-t,study_time_minutes:n},{onConflict:"user_id,date",ignoreDuplicates:!1}).select();return{data:r,error:i}}static async getWeeklyProgress(){const{data:{user:e}}=await u.auth.getUser();if(!e)throw new Error("Utente non autenticato");const{data:t,error:n}=await u.from("study_analytics").select("*").eq("user_id",e.id).gte("date",new Date(Date.now()-6048e5).toISOString().split("T")[0]).order("date",{ascending:!0});return{data:t,error:n}}static async getCardsForReview(){const{data:{user:e}}=await u.auth.getUser();if(!e)throw new Error("Utente non autenticato");const{data:t,error:n}=await u.rpc("get_cards_for_review",{user_uuid:e.id});return{data:t,error:n}}static generateInsights(e){const t=[];if(e.study_streak>0&&t.push({icon:"üî•",title:`Streak di ${e.study_streak} giorni!`,description:e.study_streak>=7?"Fantastico! Mantieni questo ritmo per consolidare le tue conoscenze.":"Continua cos√¨! Ogni giorno di studio conta per il tuo apprendimento."}),e.accuracy_rate>0&&(e.accuracy_rate>=80?t.push({icon:"üéØ",title:"Eccellente accuratezza!",description:`Con il ${e.accuracy_rate}% di risposte corrette, stai padroneggiando bene i contenuti.`}):e.accuracy_rate<60&&t.push({icon:"üìö",title:"Focus sul ripasso",description:`La tua accuratezza √® del ${e.accuracy_rate}%. Considera di ripassare i contenuti pi√π difficili.`})),e.total_study_time>0){const n=Math.round(e.total_study_time/60);n>=10&&t.push({icon:"‚è∞",title:"Studio intensivo!",description:`Hai studiato ${n} ore negli ultimi 30 giorni. Ottimo impegno!`})}return e.cards_due_today>0&&t.push({icon:"üìÖ",title:"Carte in attesa",description:`Hai ${e.cards_due_today} carte da ripassare oggi. Non dimenticare di studiare!`}),e.total_cards>0&&t.push({icon:"üìà",title:"Progresso costante",description:`Hai creato ${e.total_cards} flashcard in ${e.total_sets} set. Continua a espandere le tue conoscenze!`}),t}}function p(e){return console.error("Supabase Error:",e),e.message.includes("JWT")?"Sessione scaduta. Effettua nuovamente l'accesso.":e.message.includes("permission")?"Non hai i permessi per eseguire questa operazione.":e.message.includes("network")?"Errore di connessione. Verifica la tua connessione internet.":e.message||"Si √® verificato un errore imprevisto."}window.Recharts={LineChart:l,Line:c,XAxis:d,YAxis:o,CartesianGrid:i,Tooltip:r,Legend:s,ResponsiveContainer:a,BarChart:n,Bar:t};const f="https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",v="flashcard_api_key",w="flashcard_theme";let S={flashcards:[],currentIndex:0,isLoading:!1,apiKey:null,useCustomApi:!1,answerRevealed:!1,user:null,studyMode:!1,studyCards:[],currentStudyIndex:0,cardsStudiedToday:0,studyStartTime:null,selectedStudyMode:null,quizData:[],matchingData:[],memoryData:[],speedData:[],quizScore:0,matchingScore:0,memoryScore:0,speedScore:0};const I={authSection:document.getElementById("authSection"),loginForm:document.getElementById("loginForm"),userInfo:document.getElementById("userInfo"),emailInput:document.getElementById("emailInput"),passwordInput:document.getElementById("passwordInput"),loginBtn:document.getElementById("loginBtn"),signupBtn:document.getElementById("signupBtn"),logoutBtn:document.getElementById("logoutBtn"),userEmail:document.getElementById("userEmail"),userStats:document.getElementById("userStats"),analyticsBtn:document.getElementById("analyticsBtn"),textInput:document.getElementById("textInput"),pdfInput:document.getElementById("pdfInput"),pdfInfo:document.getElementById("pdfInfo"),apiChoiceRadios:document.querySelectorAll('input[name="apiChoice"]'),customApiSection:document.getElementById("customApiSection"),apiKeyInput:document.getElementById("apiKeyInput"),saveApiKeyBtn:document.getElementById("saveApiKey"),generateBtn:document.getElementById("generateBtn"),flashcardSection:document.getElementById("flashcardSection"),flashcardCounter:document.getElementById("flashcardCounter"),currentCard:document.getElementById("currentCard"),totalCards:document.getElementById("totalCards"),questionText:document.getElementById("questionText"),answerText:document.getElementById("answerText"),answerSection:document.getElementById("answerSection"),revealAnswerBtn:document.getElementById("revealAnswerBtn"),prevBtn:document.getElementById("prevBtn"),nextBtn:document.getElementById("nextBtn"),saveSetBtn:document.getElementById("saveSetBtn"),exportBtn:document.getElementById("exportBtn"),copyBtn:document.getElementById("copyBtn"),analyticsSection:document.getElementById("analyticsSection"),analyticsTimeframe:document.getElementById("analyticsTimeframe"),refreshAnalytics:document.getElementById("refreshAnalytics"),totalSets:document.getElementById("totalSets"),totalCards:document.getElementById("totalCards"),studyStreak:document.getElementById("studyStreak"),accuracyRate:document.getElementById("accuracyRate"),totalStudyTime:document.getElementById("totalStudyTime"),cardsDueToday:document.getElementById("cardsDueToday"),weeklyProgressChart:document.getElementById("weeklyProgressChart"),accuracyChart:document.getElementById("accuracyChart"),insightsList:document.getElementById("insightsList"),studySection:document.getElementById("studySection"),startStudyBtn:document.getElementById("startStudyBtn"),stopStudyBtn:document.getElementById("stopStudyBtn"),cardsDue:document.getElementById("cardsDue"),cardsStudied:document.getElementById("cardsStudied"),currentStudyMode:document.getElementById("currentStudyMode"),studyCard:document.getElementById("studyCard"),studyProgress:document.getElementById("studyProgress"),studyProgressText:document.getElementById("studyProgressText"),studyQuestionText:document.getElementById("studyQuestionText"),studyRevealBtn:document.getElementById("studyRevealBtn"),studyAnswer:document.getElementById("studyAnswer"),studyAnswerText:document.getElementById("studyAnswerText"),studyModeCards:document.querySelectorAll(".study-mode-card"),studyModeSelector:document.querySelector(".study-mode-selector"),quizMode:document.getElementById("quizMode"),quizQuestion:document.getElementById("quizQuestionText"),quizOptions:document.getElementById("quizOptions"),quizFeedback:document.getElementById("quizFeedback"),feedbackIcon:document.getElementById("feedbackIcon"),feedbackText:document.getElementById("feedbackText"),correctAnswer:document.getElementById("correctAnswer"),nextQuizBtn:document.getElementById("nextQuizBtn"),quizProgress:document.getElementById("quizProgress"),quizProgressText:document.getElementById("quizProgressText"),matchingMode:document.getElementById("matchingMode"),matchingGrid:document.getElementById("matchingGrid"),matchingFeedback:document.getElementById("matchingFeedback"),matchingFeedbackIcon:document.getElementById("matchingFeedbackIcon"),matchingFeedbackText:document.getElementById("matchingFeedbackText"),matchingProgress:document.getElementById("matchingProgress"),matchingProgressText:document.getElementById("matchingProgressText"),memoryMode:document.getElementById("memoryMode"),memoryGrid:document.getElementById("memoryGrid"),memoryAttempts:document.getElementById("memoryAttempts"),memoryPairs:document.getElementById("memoryPairs"),memoryProgress:document.getElementById("memoryProgress"),memoryProgressText:document.getElementById("memoryProgressText"),speedMode:document.getElementById("speedMode"),speedQuestion:document.getElementById("speedQuestionText"),speedAnswer:document.getElementById("speedAnswerText"),speedTimer:document.getElementById("speedTimer"),revealSpeedAnswer:document.getElementById("revealSpeedAnswer"),speedNext:document.getElementById("speedNext"),speedProgress:document.getElementById("speedProgress"),speedProgressText:document.getElementById("speedProgressText"),savedFlashcardsSection:document.getElementById("savedFlashcardsSection"),savedSetsGrid:document.getElementById("savedSetsGrid"),emptySavedSets:document.getElementById("emptySavedSets"),refreshSetsBtn:document.getElementById("refreshSetsBtn"),clearAllBtn:document.getElementById("clearAllBtn"),exportModal:document.getElementById("exportModal"),exportJson:document.getElementById("exportJson"),exportCsv:document.getElementById("exportCsv"),closeModal:document.getElementById("closeModal"),saveSetModal:document.getElementById("saveSetModal"),setNameInput:document.getElementById("setNameInput"),confirmSaveBtn:document.getElementById("confirmSaveBtn"),cancelSaveBtn:document.getElementById("cancelSaveBtn")};function E(){I.loginForm.classList.remove("hidden"),I.userInfo.classList.add("hidden"),S.user=null}function x(){I.loginForm.classList.add("hidden"),I.userInfo.classList.remove("hidden"),I.userEmail.textContent=S.user.email,B()}async function B(){if(S.user)try{const{data:e,error:t}=await g.getUserAnalytics(30);if(t)throw t;const n=e||{};I.userStats.textContent=`${n.total_sets||0} set ‚Ä¢ ${n.total_cards||0} carte`}catch(e){console.error("Errore nel caricamento delle statistiche:",e)}}async function L(){const e=I.emailInput.value.trim(),t=I.passwordInput.value.trim();if(e&&t)try{Se(!0);const{data:n,error:a}=await m.signIn(e,t);if(a)throw a;S.user=n.user,x(),O(),Q(),Be("Accesso effettuato con successo!"),I.emailInput.value="",I.passwordInput.value=""}catch(n){xe(p(n))}finally{Se(!1)}else xe("Inserisci email e password.")}async function C(){const e=I.emailInput.value.trim(),t=I.passwordInput.value.trim();if(e&&t)if(t.length<6)xe("La password deve essere di almeno 6 caratteri.");else try{Se(!0);const{data:n,error:a}=await m.signUp(e,t);if(a)throw a;Be("Registrazione completata! Controlla la tua email per confermare l'account."),I.emailInput.value="",I.passwordInput.value=""}catch(n){xe(p(n))}finally{Se(!1)}else xe("Inserisci email e password.")}async function _(){try{const{error:e}=await m.signOut();if(e)throw e;S.user=null,E(),Be("Logout effettuato con successo!")}catch(e){xe(p(e))}}function b(){I.textInput.value.trim()&&(I.pdfInput.value="",I.pdfInfo.classList.add("hidden"))}async function T(e){const t=e.target.files[0];if(t)if("application/pdf"===t.type)try{Se(!0);const e=await async function(e){return new Promise(((t,n)=>{const a=new FileReader;a.onload=async function(e){try{const n=new Uint8Array(e.target.result),a=await pdfjsLib.getDocument(n).promise;let s="";for(let e=1;e<=a.numPages;e++){const t=await a.getPage(e),n=await t.getTextContent();s+=n.items.map((e=>e.str)).join(" ")+"\n"}t(s.trim())}catch(a){n(a)}},a.onerror=n,a.readAsArrayBuffer(e)}))}(t);I.textInput.value=e,I.pdfInfo.textContent=`PDF caricato: ${t.name} (${(t.size/1024).toFixed(1)} KB)`,I.pdfInfo.classList.remove("hidden")}catch(n){xe("Errore nella lettura del PDF: "+n.message)}finally{Se(!1)}else xe("Per favore seleziona un file PDF valido.")}function k(e){const t="custom"===e.target.value;S.useCustomApi=t,t?(I.customApiSection.classList.remove("hidden"),I.apiKeyInput.focus()):I.customApiSection.classList.add("hidden")}function M(){const e=I.apiKeyInput.value.trim();e?(S.apiKey=e,localStorage.setItem(v,e),Be("API key salvata con successo!")):xe("Inserisci una API key valida.")}async function A(){const e=I.textInput.value.trim();if(e)if(!S.useCustomApi||S.apiKey)try{let a;if(Se(!0,"Analisi del testo in corso..."),S.user){Se(!0,"Generazione AI in corso...");try{const{data:t,error:n}=await async function(e,t="medio",n="",a=10){const{data:{session:s}}=await u.auth.getSession();if(!s)throw new Error("Utente non autenticato");const{data:r,error:i}=await u.functions.invoke("generate-flashcards",{body:{text:e,difficulty:t,subject:n,cardCount:a},headers:{Authorization:`Bearer ${s.access_token}`}});return{data:r,error:i}}(e,"medio","",10);if(n)throw n;a=t.flashcards}catch(t){if(console.warn("Edge Function non disponibile, fallback a API diretta:",t),!S.apiKey)throw new Error("Edge Function non disponibile e nessuna API key fornita. Configura una API key per il fallback.");try{a=await P(e)}catch(n){throw new Error(`Edge Function e API diretta non disponibili: ${n.message}`)}}}else{if(!S.useCustomApi||!S.apiKey)throw new Error("Devi effettuare l'accesso o fornire una API key per generare flashcard.");Se(!0,"Chiamata API in corso..."),a=await P(e)}Se(!0,"Validazione flashcard..."),a&&a.length>0?(S.flashcards=a,S.currentIndex=0,S.answerRevealed=!1,q(),D(),Be(`Generate ${a.length} flashcard con successo!`)):xe("Nessuna flashcard generata. Riprova con un testo diverso.")}catch(a){xe("Errore nella generazione delle flashcard: "+a.message)}finally{Se(!1)}else xe("Inserisci la tua API key per continuare.");else xe("Inserisci del testo o carica un PDF per generare le flashcard.")}async function P(e){var t;const n=S.apiKey,a=f;if(!n)throw new Error("API Key non configurata per il fallback");const s={contents:[{parts:[{text:`Genera flashcard con domande e risposte chiare e concise basate sul seguente testo. \n    Rispondi SOLO con un array JSON di oggetti con questa struttura esatta:\n    [\n        {"domanda": "testo della domanda", "risposta": "testo della risposta"},\n        {"domanda": "testo della domanda", "risposta": "testo della risposta"}\n    ]\n    \n    Testo da elaborare:\n    ${e}`}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:2048}},r=await fetch(`${a}?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const e=await r.json();throw new Error(`Errore API: ${(null==(t=e.error)?void 0:t.message)||r.statusText}`)}const i=(await r.json()).candidates[0].content.parts[0].text.match(/\[[\s\S]*\]/);if(!i)throw new Error("Formato di risposta non valido dall'API");try{return JSON.parse(i[0]).filter((e=>e.domanda&&e.risposta))}catch(o){throw new Error("Errore nel parsing della risposta JSON")}}function q(){I.flashcardSection.classList.remove("hidden"),I.flashcardSection.scrollIntoView({behavior:"smooth"})}function D(){if(0===S.flashcards.length)return;const e=S.flashcards[S.currentIndex];I.questionText.textContent=e.domanda,I.answerText.textContent=e.risposta,I.currentCard.textContent=S.currentIndex+1,I.totalCards.textContent=S.flashcards.length,S.answerRevealed=!1,I.answerSection.classList.add("hidden"),I.revealAnswerBtn.classList.remove("hidden"),I.revealAnswerBtn.textContent="üëÅÔ∏è Mostra Risposta",I.prevBtn.disabled=0===S.currentIndex,I.nextBtn.disabled=S.currentIndex===S.flashcards.length-1}function z(){S.answerRevealed=!S.answerRevealed,S.answerRevealed?(I.answerSection.classList.remove("hidden"),I.answerSection.classList.add("revealed"),I.revealAnswerBtn.textContent="üôà Nascondi Risposta"):(I.answerSection.classList.add("hidden"),I.answerSection.classList.remove("revealed"),I.revealAnswerBtn.textContent="üëÅÔ∏è Mostra Risposta")}function $(){S.currentIndex>0&&(S.currentIndex--,D())}function F(){S.currentIndex<S.flashcards.length-1&&(S.currentIndex++,D())}function N(){0!==S.flashcards.length?S.user?(I.setNameInput.value="",I.saveSetModal.classList.remove("hidden"),I.setNameInput.focus()):xe("Devi effettuare l'accesso per salvare le flashcard."):xe("Nessuna flashcard da salvare.")}function R(){I.saveSetModal.classList.add("hidden")}async function U(){const e=I.setNameInput.value.trim();if(e)if(0!==S.flashcards.length)if(S.user)try{Se(!0);const{data:t,error:n}=await y.createFlashcardSet(e,`Set generato il ${(new Date).toLocaleDateString("it-IT")}`,"Generale");if(n)throw n;const{error:a}=await y.addFlashcards(t.id,S.flashcards);if(a)throw a;R(),Be(`Set "${e}" salvato con successo!`),O(),B()}catch(t){xe(p(t))}finally{Se(!1)}else xe("Devi effettuare l'accesso per salvare le flashcard.");else xe("Nessuna flashcard da salvare.");else xe("Inserisci un nome per il set di flashcard.")}async function O(){if(!S.user)return I.emptySavedSets.classList.remove("hidden"),void I.savedSetsGrid.classList.add("hidden");try{const{data:e,error:t}=await y.getUserFlashcardSets();if(t)throw t;!function(e){if(0===e.length)return I.emptySavedSets.classList.remove("hidden"),void I.savedSetsGrid.classList.add("hidden");I.emptySavedSets.classList.add("hidden"),I.savedSetsGrid.classList.remove("hidden"),I.savedSetsGrid.innerHTML=e.map((e=>`\n        <div class="saved-set-card" data-set-id="${e.id}">\n            <div class="saved-set-title">${e.name}</div>\n            <div class="saved-set-info">\n                ${e.total_cards} flashcard ‚Ä¢ Creato il ${new Date(e.created_at).toLocaleDateString("it-IT")}\n                ${e.is_public?" ‚Ä¢ üåê Pubblico":""}\n            </div>\n            <div class="saved-set-actions">\n                <button class="btn-secondary" data-action="load" data-set-id="${e.id}">üìñ Apri</button>\n                <button class="btn-secondary" data-action="delete" data-set-id="${e.id}">üóëÔ∏è Elimina</button>\n            </div>\n        </div>\n    `)).join(""),I.savedSetsGrid.querySelectorAll('[data-action="load"]').forEach((e=>{e.addEventListener("click",(()=>j(e.dataset.setId)))})),I.savedSetsGrid.querySelectorAll('[data-action="delete"]').forEach((e=>{e.addEventListener("click",(()=>G(e.dataset.setId)))}))}(e||[])}catch(e){console.error("Errore nel caricamento delle flashcard salvate:",e),xe(p(e))}}async function j(e){try{const{data:t,error:n}=await y.getFlashcardSet(e);if(n)throw n;if(!t)return void xe("Set non trovato.");S.flashcards=t.flashcards.map((e=>({domanda:e.question,risposta:e.answer,difficulty:e.difficulty}))),S.currentIndex=0,S.answerRevealed=!1,q(),D(),Be(`Set "${t.name}" caricato con successo!`)}catch(t){xe(p(t))}}async function G(e){if(confirm("Sei sicuro di voler eliminare questo set di flashcard?"))try{const{error:t}=await y.deleteFlashcardSet(e);if(t)throw t;Be("Set eliminato con successo!"),O(),B()}catch(t){xe(p(t))}}async function H(){if(confirm("Sei sicuro di voler eliminare tutti i set di flashcard salvati? Questa azione non pu√≤ essere annullata."))try{const{data:e,error:t}=await y.getUserFlashcardSets();if(t)throw t;for(const n of e){const{error:e}=await y.deleteFlashcardSet(n.id);if(e)throw e}Be("Tutti i set sono stati eliminati!"),O(),B()}catch(e){xe(p(e))}}async function Q(){if(S.user)try{const{data:e,error:t}=await g.getUserAnalytics(30);if(t)throw t;const n=e||{};I.cardsDue.textContent=n.cards_due_today||0,I.cardsStudied.textContent=n.total_study_sessions||0}catch(e){console.error("Errore nel caricamento delle statistiche di studio:",e)}}function K(e){const t=e.currentTarget.dataset.mode;I.studyModeCards.forEach((e=>{e.classList.remove("selected")})),e.currentTarget.classList.add("selected"),S.selectedStudyMode=t,I.startStudyBtn.classList.remove("hidden");I.currentStudyMode.textContent={spaced:"Ripetizione Spaziata",quiz:"Quiz Mode",matching:"Matching",memory:"Memory Game",speed:"Speed Review"}[t]||"-"}async function J(){if(S.user)if(S.selectedStudyMode)try{Se(!0),I.studyModeSelector.classList.add("hidden"),await async function(){if("spaced"===S.selectedStudyMode){const{data:e,error:t}=await g.getCardsForReview();if(t)throw console.warn("Modalit√† studio non disponibile, database non configurato:",t),new Error("Modalit√† studio non disponibile. Configura il database per abilitare la ripetizione spaziata.");if(!e||0===e.length)throw new Error("Nessuna carta da ripassare oggi! üéâ");S.studyCards=e,S.currentStudyIndex=0}else{const{data:e,error:t}=await y.getUserFlashcardSets();if(t||!e||0===e.length)throw new Error("Nessuna flashcard salvata disponibile per questa modalit√†.");const n=e[0],{data:a,error:s}=await y.getFlashcardSet(n.id);if(s||!a||!a.flashcards||0===a.flashcards.length)throw new Error("Nessuna flashcard disponibile nel set selezionato.");const r=a.flashcards;switch(S.selectedStudyMode){case"quiz":S.quizData=function(e){return e.map((t=>({question:t.question,correctAnswer:t.answer,options:V(t.answer,e),difficulty:t.difficulty||2})))}(r);break;case"matching":S.matchingData=function(e){const t=e.map((e=>e.question)),n=e.map((e=>e.answer));return{questions:t.sort((()=>Math.random()-.5)),answers:n.sort((()=>Math.random()-.5)),pairs:e.map((e=>({question:e.question,answer:e.answer})))}}(r);break;case"memory":S.memoryData=function(e){const t=[];return e.forEach(((e,n)=>{t.push({id:`q${n}`,content:e.question,type:"question",pairId:n}),t.push({id:`a${n}`,content:e.answer,type:"answer",pairId:n})})),t.sort((()=>Math.random()-.5))}(r);break;case"speed":S.speedData=function(e){return e.map((e=>({question:e.question,answer:e.answer,difficulty:e.difficulty||2})))}(r)}S.currentStudyIndex=0}}(),S.studyMode=!0,S.studyStartTime=Date.now(),S.cardsStudiedToday=0,I.startStudyBtn.classList.add("hidden"),I.stopStudyBtn.classList.remove("hidden"),function(){switch(S.selectedStudyMode){case"spaced":I.studyCard.classList.remove("hidden"),ue();break;case"quiz":I.quizMode.classList.remove("hidden"),S.quizScore=0,S.currentStudyIndex=0,W();break;case"matching":I.matchingMode.classList.remove("hidden"),S.matchingScore=0,S.currentStudyIndex=0,function(){const e=S.matchingData,t=S.matchingScore/e.pairs.length*100;I.matchingProgress.style.width=`${t}%`,I.matchingProgressText.textContent=`${S.matchingScore} di ${e.pairs.length}`,I.matchingGrid.innerHTML="";const n=document.createElement("div");n.className="matching-column",n.innerHTML="<h4>Domande</h4>",e.questions.forEach(((e,t)=>{const a=document.createElement("div");a.className="matching-item",a.textContent=e,a.dataset.type="question",a.dataset.index=t,a.addEventListener("click",te),n.appendChild(a)}));const a=document.createElement("div");a.className="matching-column",a.innerHTML="<h4>Risposte</h4>",e.answers.forEach(((e,t)=>{const n=document.createElement("div");n.className="matching-item",n.textContent=e,n.dataset.type="answer",n.dataset.index=t,n.addEventListener("click",te),a.appendChild(n)})),I.matchingGrid.appendChild(n),I.matchingGrid.appendChild(a),I.matchingFeedback.classList.add("hidden")}();break;case"memory":I.memoryMode.classList.remove("hidden"),S.memoryScore=0,S.memoryAttempts=0,S.memoryPairs=0,S.currentStudyIndex=0,function(){const e=S.memoryData,t=S.memoryPairs/(e.length/2)*100;I.memoryProgress.style.width=`${t}%`,I.memoryProgressText.textContent=`${S.memoryPairs} di ${e.length/2}`,I.memoryAttempts.textContent=S.memoryAttempts,I.memoryPairs.textContent=S.memoryPairs,I.memoryGrid.innerHTML="",e.forEach(((e,t)=>{const n=document.createElement("div");n.className="memory-card",n.dataset.index=t,n.dataset.pairId=e.pairId,n.dataset.type=e.type,n.addEventListener("click",se),I.memoryGrid.appendChild(n)}))}();break;case"speed":I.speedMode.classList.remove("hidden"),S.speedScore=0,S.currentStudyIndex=0,re()}}()}catch(e){console.error("Errore modalit√† studio:",e),xe("Errore nella modalit√† studio. Verifica la configurazione del database.")}finally{Se(!1)}else xe("Seleziona una modalit√† di studio prima di iniziare.");else xe("Devi effettuare l'accesso per usare la modalit√† studio.")}function V(e,t){const n=[e],a=t.filter((t=>t.answer!==e)).map((e=>e.answer)).sort((()=>Math.random()-.5)).slice(0,3);return n.push(...a),n.sort((()=>Math.random()-.5))}function W(){const e=S.quizData[S.currentStudyIndex];if(!e)return void Z();const t=(S.currentStudyIndex+1)/S.quizData.length*100;I.quizProgress.style.width=`${t}%`,I.quizProgressText.textContent=`${S.currentStudyIndex+1} di ${S.quizData.length}`,I.quizQuestion.textContent=e.question,I.quizOptions.innerHTML="",e.options.forEach(((e,t)=>{const n=document.createElement("button");n.className="quiz-option",n.textContent=e,n.dataset.answer=e,n.addEventListener("click",X),I.quizOptions.appendChild(n)})),I.quizFeedback.classList.add("hidden")}function X(e){const t=e.target.dataset.answer,n=S.quizData[S.currentStudyIndex],a=t===n.correctAnswer;document.querySelectorAll(".quiz-option").forEach((e=>{e.disabled=!0,e.dataset.answer===n.correctAnswer?e.classList.add("correct"):e.dataset.answer!==t||a||e.classList.add("incorrect")})),a?(S.quizScore++,I.feedbackIcon.textContent="‚úÖ",I.feedbackText.textContent="Corretto!",I.correctAnswer.textContent=""):(I.feedbackIcon.textContent="‚ùå",I.feedbackText.textContent="Sbagliato!",I.correctAnswer.textContent=`Risposta corretta: ${n.correctAnswer}`),I.quizFeedback.classList.remove("hidden")}function Y(){S.currentStudyIndex++,S.currentStudyIndex<S.quizData.length?W():Z()}function Z(){const e=Math.round(S.quizScore/S.quizData.length*100);Be(`Quiz completato! Punteggio: ${S.quizScore}/${S.quizData.length} (${e}%)`),le()}document.addEventListener("DOMContentLoaded",(()=>{!function(){try{pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"}catch(e){console.warn("PDF.js non disponibile:",e)}(function(){const e=document.createElement("button");e.className="theme-toggle",e.setAttribute("aria-label","Cambia tema"),e.addEventListener("click",Ce),document.body.appendChild(e)})(),console.log("Flashcard Generator v2.0 inizializzato con Supabase")}(),I.loginBtn.addEventListener("click",L),I.signupBtn.addEventListener("click",C),I.logoutBtn.addEventListener("click",_),I.analyticsBtn.addEventListener("click",ye),I.textInput.addEventListener("input",b),I.pdfInput.addEventListener("change",T),I.apiChoiceRadios.forEach((e=>{e.addEventListener("change",k)})),I.saveApiKeyBtn.addEventListener("click",M),I.generateBtn.addEventListener("click",A),I.revealAnswerBtn.addEventListener("click",z),I.prevBtn.addEventListener("click",$),I.nextBtn.addEventListener("click",F),I.saveSetBtn.addEventListener("click",N),I.exportBtn.addEventListener("click",pe),I.copyBtn.addEventListener("click",ve),I.exportJson.addEventListener("click",(()=>we("json"))),I.exportCsv.addEventListener("click",(()=>we("csv"))),I.closeModal.addEventListener("click",fe),I.confirmSaveBtn.addEventListener("click",U),I.cancelSaveBtn.addEventListener("click",R),I.setNameInput.addEventListener("keypress",(e=>{"Enter"===e.key&&U()})),I.analyticsTimeframe.addEventListener("change",he),I.refreshAnalytics.addEventListener("click",he),I.startStudyBtn.addEventListener("click",J),I.stopStudyBtn.addEventListener("click",le),I.studyRevealBtn.addEventListener("click",me),document.addEventListener("click",(e=>{e.target.classList.contains("rating-btn")&&async function(e){const t=S.studyCards[S.currentStudyIndex];try{const n=S.studyStartTime?Math.round((Date.now()-S.studyStartTime)/1e3):null,{error:a}=await h.recordStudySession(t.card_id,e,{responseTime:n,mode:S.selectedStudyMode||"spaced_repetition",deviceType:"desktop"});if(a)throw a;S.cardsStudiedToday++,S.currentStudyIndex++,S.currentStudyIndex<S.studyCards.length?ue():(Be("Hai completato tutte le carte per oggi! üéâ"),le()),Q()}catch(n){xe(p(n))}}(parseInt(e.target.dataset.quality))})),I.studyModeCards.forEach((e=>{e.addEventListener("click",K)})),I.nextQuizBtn.addEventListener("click",Y),I.revealSpeedAnswer.addEventListener("click",oe),I.speedNext.addEventListener("click",de),I.refreshSetsBtn.addEventListener("click",O),I.clearAllBtn.addEventListener("click",H),I.exportModal.addEventListener("click",(e=>{e.target===I.exportModal&&fe()})),I.saveSetModal.addEventListener("click",(e=>{e.target===I.saveSetModal&&R()})),function(){const e=localStorage.getItem(v);e&&(S.apiKey=e,I.apiKeyInput.value=e);const t=localStorage.getItem(w)||"light";document.documentElement.setAttribute("data-theme",t)}(),async function(){const{user:e}=await m.getCurrentUser();e?(S.user=e,x(),O(),Q()):E()}()}));let ee=null;function te(e){const t=e.target;if(!t.classList.contains("matched"))if(ee){if(ee===t)return ee.classList.remove("selected"),void(ee=null);if(function(e,t){const n=e.textContent,a=t.textContent;return S.matchingData.pairs.some((e=>e.question===n&&e.answer===a))}(ee,t)){ee.classList.add("matched"),t.classList.add("matched"),S.matchingScore++,I.matchingFeedbackIcon.textContent="‚úÖ",I.matchingFeedbackText.textContent="Perfetto!",I.matchingFeedback.classList.remove("hidden");const e=S.matchingScore/S.matchingData.pairs.length*100;I.matchingProgress.style.width=`${e}%`,I.matchingProgressText.textContent=`${S.matchingScore} di ${S.matchingData.pairs.length}`,S.matchingScore===S.matchingData.pairs.length&&setTimeout((()=>{Be("Matching completato! Tutte le coppie trovate! üéâ"),le()}),1e3)}else I.matchingFeedbackIcon.textContent="‚ùå",I.matchingFeedbackText.textContent="Prova ancora!",I.matchingFeedback.classList.remove("hidden"),setTimeout((()=>{ee.classList.remove("selected"),t.classList.remove("selected")}),1e3);ee=null}else ee=t,t.classList.add("selected")}let ne=[],ae=!1;function se(e){if(ae)return;const t=e.target;if(t.classList.contains("flipped")||t.classList.contains("matched"))return;const n=S.memoryData[t.dataset.index];if(t.textContent=n.content,t.classList.add("flipped"),ne.push(t),2===ne.length){ae=!0,S.memoryAttempts++,I.memoryAttempts.textContent=S.memoryAttempts;const[e,t]=ne;e.dataset.pairId===t.dataset.pairId?setTimeout((()=>{e.classList.add("matched"),t.classList.add("matched"),S.memoryPairs++,I.memoryPairs.textContent=S.memoryPairs;const n=S.memoryPairs/(S.memoryData.length/2)*100;I.memoryProgress.style.width=`${n}%`,I.memoryProgressText.textContent=`${S.memoryPairs} di ${S.memoryData.length/2}`,S.memoryPairs===S.memoryData.length/2&&setTimeout((()=>{Be(`Memory completato! ${S.memoryAttempts} tentativi! üéâ`),le()}),1e3),ae=!1}),500):setTimeout((()=>{e.classList.remove("flipped"),t.classList.remove("flipped"),e.textContent="",t.textContent="",ae=!1}),1e3),ne=[]}}function re(){const e=S.speedData[S.currentStudyIndex];if(!e)return void ce();const t=(S.currentStudyIndex+1)/S.speedData.length*100;I.speedProgress.style.width=`${t}%`,I.speedProgressText.textContent=`${S.currentStudyIndex+1} di ${S.speedData.length}`,I.speedQuestion.textContent=e.question,I.speedAnswer.classList.add("hidden"),I.speedAnswer.textContent=e.answer,I.revealSpeedAnswer.classList.remove("hidden"),I.speedNext.classList.add("hidden"),function(){let e=5;I.speedTimer.textContent=e,ie=setInterval((()=>{e--,I.speedTimer.textContent=e,e<=0&&(clearInterval(ie),oe())}),1e3)}()}let ie=null;function oe(){ie&&clearInterval(ie),I.speedAnswer.classList.remove("hidden"),I.revealSpeedAnswer.classList.add("hidden"),I.speedNext.classList.remove("hidden")}function de(){S.currentStudyIndex++,S.currentStudyIndex<S.speedData.length?re():ce()}function ce(){Be(`Speed Review completato! ${S.speedData.length} carte riviste! ‚ö°`),le()}async function le(){if(S.studyMode&&S.studyStartTime)try{const e=Math.round((Date.now()-S.studyStartTime)/1e3),t=S.selectedStudyMode||"spaced_repetition";await g.recordStudySession({session_end:(new Date).toISOString(),cards_studied:S.cardsStudiedToday,correct_answers:S.cardsStudiedToday,total_time_seconds:e,study_mode:t})}catch(e){console.error("Errore nel salvataggio della sessione:",e)}S.studyMode=!1,S.studyCards=[],S.currentStudyIndex=0,S.studyStartTime=null,S.cardsStudiedToday=0,S.selectedStudyMode=null,I.studyCard.classList.add("hidden"),I.studyAnswer.classList.add("hidden"),I.quizMode.classList.add("hidden"),I.matchingMode.classList.add("hidden"),I.memoryMode.classList.add("hidden"),I.speedMode.classList.add("hidden"),I.studyModeSelector.classList.remove("hidden"),I.studyModeCards.forEach((e=>{e.classList.remove("selected")})),I.startStudyBtn.classList.add("hidden"),I.stopStudyBtn.classList.add("hidden"),I.currentStudyMode.textContent="-",Q()}function ue(){if(S.currentStudyIndex>=S.studyCards.length)return Be("Hai completato tutte le carte per oggi! üéâ"),le(),void Q();const e=S.studyCards[S.currentStudyIndex];I.studyQuestionText.textContent=e.question,I.studyAnswerText.textContent=e.answer,I.studyAnswer.classList.add("hidden"),I.studyRevealBtn.classList.remove("hidden"),I.studyRevealBtn.textContent="Mostra Risposta";const t=(S.currentStudyIndex+1)/S.studyCards.length*100;I.studyProgress.style.width=`${t}%`,I.studyProgressText.textContent=`${S.currentStudyIndex+1} di ${S.studyCards.length}`}function me(){I.studyAnswer.classList.remove("hidden"),I.studyRevealBtn.classList.add("hidden")}function ye(){S.user?(I.analyticsSection.classList.remove("hidden"),I.analyticsSection.scrollIntoView({behavior:"smooth"}),he()):xe("Devi effettuare l'accesso per visualizzare gli analytics.")}async function he(){var e;if(S.user)try{Se(!0,"Caricamento analytics...");const t=parseInt(I.analyticsTimeframe.value),{data:n,error:a}=await g.getUserAnalytics(t);if(a)return console.warn("Analytics non disponibili, mostrando dati di base:",a),void ge();n&&(e=n,I.totalSets.textContent=e.total_sets||0,I.totalCards.textContent=e.total_cards||0,I.studyStreak.textContent=e.study_streak||0,I.accuracyRate.textContent=`${e.accuracy_rate||0}%`,I.totalStudyTime.textContent=`${Math.round((e.total_study_time||0)/60)}h`,I.cardsDueToday.textContent=e.cards_due_today||0,function(e){const t=I.weeklyProgressChart;if(!e||0===e.length)return void(t.innerHTML='<div class="no-data">Nessun dato disponibile</div>');const n=Math.max(...e.map((e=>e.cards_studied||0)));t.innerHTML=`\n        <div class="simple-chart">\n            ${e.map((e=>`\n                <div class="chart-bar">\n                    <div class="bar" style="height: ${(e.cards_studied||0)/n*100}%"></div>\n                    <div class="bar-label">${new Date(e.date).toLocaleDateString("it-IT",{weekday:"short"})}</div>\n                </div>\n            `)).join("")}\n        </div>\n    `}(e.weekly_progress||[]),function(e){const t=I.accuracyChart;e&&0!==e.length?t.innerHTML=`\n        <div class="accuracy-chart">\n            ${e.map((e=>`\n                <div class="accuracy-day">\n                    <div class="accuracy-bar">\n                        <div class="accuracy-fill" style="width: ${e.accuracy||0}%"></div>\n                    </div>\n                    <div class="accuracy-label">${e.accuracy||0}%</div>\n                </div>\n            `)).join("")}\n        </div>\n    `:t.innerHTML='<div class="no-data">Nessun dato disponibile</div>'}(e.weekly_progress||[]),function(e){const t=g.generateInsights(e);if(0===t.length)return void(I.insightsList.innerHTML='\n            <div class="insight-item">\n                <div class="insight-icon">üéØ</div>\n                <div class="insight-content">\n                    <div class="insight-title">Inizia a studiare!</div>\n                    <div class="insight-description">Crea le tue prime flashcard e inizia il tuo percorso di apprendimento.</div>\n                </div>\n            </div>\n        ');I.insightsList.innerHTML=t.map((e=>`\n        <div class="insight-item">\n            <div class="insight-icon">${e.icon}</div>\n            <div class="insight-content">\n                <div class="insight-title">${e.title}</div>\n                <div class="insight-description">${e.description}</div>\n            </div>\n        </div>\n    `)).join("")}(n))}catch(t){console.error("Errore analytics:",t),ge()}finally{Se(!1)}}function ge(){I.totalSets.textContent="0",I.totalCards.textContent="0",I.studyStreak.textContent="0",I.accuracyRate.textContent="0%",I.totalStudyTime.textContent="0h",I.cardsDueToday.textContent="0",I.weeklyProgressChart.innerHTML='<div class="no-data">Database non configurato</div>',I.accuracyChart.innerHTML='<div class="no-data">Database non configurato</div>',I.insightsList.innerHTML='\n        <div class="insight-item">\n            <div class="insight-icon">‚ö†Ô∏è</div>\n            <div class="insight-content">\n                <div class="insight-title">Database non configurato</div>\n                <div class="insight-description">Esegui lo schema SQL nel dashboard Supabase per abilitare gli analytics completi.</div>\n            </div>\n        </div>\n    '}function pe(){I.exportModal.classList.remove("hidden")}function fe(){I.exportModal.classList.add("hidden")}async function ve(){if(0===S.flashcards.length)return void xe("Nessuna flashcard da copiare.");const e=S.flashcards.map(((e,t)=>`${t+1}. Domanda: ${e.domanda}\n   Risposta: ${e.risposta}`)).join("\n\n");try{await navigator.clipboard.writeText(e),Be("Flashcard copiate negli appunti!")}catch(t){xe("Errore nella copia: "+t.message)}}function we(e){if(0===S.flashcards.length)return void xe("Nessuna flashcard da esportare.");let t,n,a;if("json"===e)t=JSON.stringify(S.flashcards,null,2),n="flashcard.json",a="application/json";else if("csv"===e){t=["Domanda,Risposta",...S.flashcards.map((e=>`"${e.domanda.replace(/"/g,'""')}","${e.risposta.replace(/"/g,'""')}"`))].join("\n"),n="flashcard.csv",a="text/csv"}const s=new Blob([t],{type:a}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),fe(),Be(`Flashcard esportate in formato ${e.toUpperCase()}!`)}function Se(e,t="Elaborazione in corso..."){S.isLoading=e;const n=I.generateBtn.querySelector(".btn-text"),a=I.generateBtn.querySelector(".loading-spinner");e?(n.textContent=t,n.classList.remove("hidden"),a.classList.remove("hidden"),I.generateBtn.disabled=!0,function(e){Ee();const t=document.createElement("div");t.id="progress-indicator",t.className="progress-indicator",t.innerHTML=`\n        <div class="progress-content">\n            <div class="progress-spinner"></div>\n            <div class="progress-text">${e}</div>\n            <div class="progress-steps">\n                <div class="step active" data-step="1">Analisi testo</div>\n                <div class="step" data-step="2">Generazione AI</div>\n                <div class="step" data-step="3">Validazione</div>\n            </div>\n        </div>\n    `,document.body.appendChild(t),setTimeout((()=>Ie(2)),1e3),setTimeout((()=>Ie(3)),2e3)}(t)):(n.textContent="Genera Flashcard",n.classList.remove("hidden"),a.classList.add("hidden"),I.generateBtn.disabled=!1,Ee())}function Ie(e){document.querySelectorAll(".progress-steps .step").forEach(((t,n)=>{n+1<=e&&t.classList.add("active")}))}function Ee(){const e=document.getElementById("progress-indicator");e&&e.remove()}function xe(e){Le(e,"error")}function Be(e){Le(e,"success")}function Le(e,t="info"){document.querySelectorAll(".notification").forEach((e=>e.remove()));const n=document.createElement("div");n.className=`notification notification-${t}`,n.textContent=e,Object.assign(n.style,{position:"fixed",top:"20px",right:"20px",padding:"1rem 1.5rem",borderRadius:"8px",color:"white",fontWeight:"600",zIndex:"10000",maxWidth:"400px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",transform:"translateX(100%)",transition:"transform 0.3s ease"}),n.style.backgroundColor="error"===t?"var(--accent-danger)":"success"===t?"var(--accent-secondary)":"var(--accent-primary)",document.body.appendChild(n),setTimeout((()=>{n.style.transform="translateX(0)"}),100),setTimeout((()=>{n.style.transform="translateX(100%)",setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n)}),300)}),5e3)}function Ce(){const e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",e),localStorage.setItem(w,e)}window.addEventListener("error",(e=>{console.error("Errore globale:",e.error),xe("Si √® verificato un errore inaspettato. Ricarica la pagina.")})),window.addEventListener("unhandledrejection",(e=>{console.error("Promise rejection non gestita:",e.reason),xe("Errore di connessione. Verifica la tua connessione internet.")})),m.onAuthStateChange(((e,t)=>{"SIGNED_IN"===e?(S.user=t.user,x(),O(),Q()):"SIGNED_OUT"===e&&(S.user=null,E())})),window.loadSavedSet=j,window.deleteSavedSet=G;
//# sourceMappingURL=main-BgQ1CBZA.js.map
